<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Maya Formula Search ðŸŒ¸</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui;background:#111;color:#eee;margin:0;padding:2rem}
  h1{color:#0ff}#out{margin-top:1rem}small{color:#aaa}
  .bar{display:inline-block;background:#0ff;height:6px;margin-left:6px}
  input{padding:8px;width:60%;font-size:1rem}
  button{padding:8px 14px;margin-left:6px;font-size:1rem;cursor:pointer}
</style>
</head>
<body>
<h1>Maya Formula Search ðŸŒ¸</h1>
<input id="q" placeholder="Ask anythingâ€¦">
<button onclick="go()">Search</button>
<div id="out"></div>

<!-- ----------  all formulas inside  ---------- -->
<script>
/* ---- tiny math ---- */
const sum=(a,f)=>a.reduce((s,x)=>s+f(x),0);
const dot=(a,b)=>sum(a,(_,i)=>a[i]*b[i]);
const mag=a=>Math.sqrt(dot(a,a));
const cos=(a,b)=>dot(a,b)/(mag(a)*mag(b)+1e-12);
const sig=x=>1/(1+Math.exp(-x));

/* ---- bag + TF-IDF ---- */
function bag(text){
  const w=(text||'').toLowerCase().match(/\w+/g)||[];
  const b={}; let t=0;
  for(const x of w){b[x]=(b[x]||0)+1;t++}
  return {bag:b,total:t};
}
let prior=0.5;
function bayes(likelihood){
  prior=(prior*likelihood)/(prior*likelihood+(1-prior)*(1-likelihood)); return prior;
}

/* ---- search trigger ---- */
function go(){
  const query=document.getElementById('q').value.trim();
  if(!query)return;
  location.href='?q='+encodeURIComponent(query);
}

/* ----------  API mode (when ?q=  )  ---------- */
const p=new URLSearchParams(location.search);
const q=p.get('q');
if(q){
  fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(q)}&format=json&no_html=1&skip_disambig=1`)
    .then(r=>r.json())
    .then(ddg=>{
      const docs=[];
      if(ddg.Abstract) docs.push({title:ddg.Heading||q,snippet:ddg.Abstract,url:ddg.AbstractURL,date:new Date().toISOString()});
      if(ddg.RelatedTopics) ddg.RelatedTopics.forEach(rt=>{if(rt.Text) docs.push({title:rt.Text.slice(0,60),snippet:rt.Text,url:rt.FirstURL||'#',date:new Date().toISOString()})});
      // scoring
      const qBag=bag(q); const qVec=tfidfVec(qBag.bag,qBag.total);
      docs.forEach(d=>{
        const dBag=bag(d.snippet); const dVec=tfidfVec(dBag.bag,dBag.total);
        const tfidf=cos(qVec,dVec); const belief=bayes(sig(tfidf*5-2));
        d.score=tfidf*bayes(sig(tfidf*5-2));
      });
      docs.sort((a,b)=>b.score-a.score);
      const out=docs.slice(0,8);
      if(p.get('format')==='json') document.body.textContent=JSON.stringify({query:q,results:out},null,2);
      else document.getElementById('out').innerHTML=out.map(d=>
        `<h3><a href="${d.url}" target="_blank">${d.title}</a></h3>
         <p>${d.snippet}</p>
         <small>score: <span class="num">${d.score.toFixed(3)}</span>
         belief: <span class="num">${(prior*100).toFixed(0)}%</span>
         <span class="bar" style="width:${d.score*200}px"></span></small>`
      ).join('<hr>');
    })
    .catch(e=>document.getElementById('out').textContent='Error: '+e.message);
}

/* ---- TF-IDF vector ---- */
const DF={}; let N=0;
function buildDF(docs){ docs.forEach(d=>{N++; const b=bag(d.snippet); for(const w in b.bag) DF[w]=(DF[w]||0)+1;}); }
function tfidfVec(bag,total){
  const vec=[]; for(const w in DF){ const tf=(bag[w]||0)/total; const idf=Math.log((N+1)/(DF[w]+1))+1; vec.push(tf*idf); } return vec;
}
</script>
</body>
</html>
